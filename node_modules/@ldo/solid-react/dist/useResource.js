"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useResource = void 0;
const react_1 = require("react");
const SolidLdoProvider_1 = require("./SolidLdoProvider");
function useResource(uri, options) {
    const { getResource } = (0, SolidLdoProvider_1.useLdo)();
    const resource = (0, react_1.useMemo)(() => {
        if (uri) {
            const resource = getResource(uri);
            if (!options?.suppressInitialRead) {
                if (options?.reloadOnMount) {
                    resource.read();
                }
                else {
                    resource.readIfUnfetched();
                }
            }
            return resource;
        }
        return undefined;
    }, [getResource, uri]);
    const [resourceRepresentation, setResourceRepresentation] = (0, react_1.useState)(resource);
    const pastResource = (0, react_1.useRef)();
    const forceReload = (0, react_1.useCallback)(() => {
        if (resource)
            setResourceRepresentation(new Proxy(resource, {}));
    }, [resource]);
    (0, react_1.useEffect)(() => {
        if (pastResource.current?.resource) {
            pastResource.current.resource.off("update", pastResource.current.callback);
        }
        pastResource.current = { resource, callback: forceReload };
        if (resource) {
            resource.on("update", forceReload);
            setResourceRepresentation(new Proxy(resource, {}));
            return () => {
                resource.off("update", forceReload);
            };
        }
        else {
            setResourceRepresentation(undefined);
        }
    }, [resource]);
    return resourceRepresentation;
}
exports.useResource = useResource;
//# sourceMappingURL=useResource.js.map